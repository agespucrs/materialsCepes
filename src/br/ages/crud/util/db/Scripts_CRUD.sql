/***
* Scripts para criaacao e insersao de dados
* Base de Dados do CePES Material 
* Casssio Trindade
* 09/09/2015
***/

USE cepes_e;

-- Tabelas

CREATE TABLE TB_FUNCAO (
  ID_FUNCAO int(11) NOT NULL AUTO_INCREMENT,
  NOME varchar(255) NOT NULL,
  DESCRICAO varchar(255) NOT NULL,
  PRIMARY KEY (ID_FUNCAO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_USUARIO (
  ID_USUARIO int(11) NOT NULL AUTO_INCREMENT,
  USUARIO varchar(30) NOT NULL,
  SENHA varchar(8) NOT NULL,
  ADMINISTRADOR tinyint(1) NOT NULL,
  MATRICULA varchar(11) NOT NULL,
  NOME varchar(120) NOT NULL,
  EMAIL varchar(120) NOT NULL,
  DATA_CADASTRO datetime NOT NULL,
  ID_FUNCAO int(11) NOT NULL,
  CPF varchar(11) NOT NULL,
  PRIMARY KEY (`ID_USUARIO`),
  UNIQUE KEY `MATRICULA_UNIQUE` (`MATRICULA`),
  UNIQUE KEY `CPF_UNIQUE` (`CPF`),
  KEY `fk_tb_funcao_idx` (`ID_FUNCAO`),
  CONSTRAINT `fk_tb_funcao` FOREIGN KEY (`ID_FUNCAO`) REFERENCES `tb_funcao` (`ID_FUNCAO`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_PROJETOS (
  ID_PROJETO int(11) NOT NULL AUTO_INCREMENT,
  NOME_PROJETO varchar(120) NOT NULL,
  PROGRAMA varchar(120) NOT NULL,
  ORIGEM varchar(120) NOT NULL,
  DATA_CADASTRO datetime NOT NULL,
  ID_CORDENADOR int(11) NOT NULL,
  PRIMARY KEY (`ID_PROJETO`),
  KEY `FK_ID_CORDENADOR_idx` (`ID_CORDENADOR`),
  CONSTRAINT `FK_ID_CORDENADOR` FOREIGN KEY (`ID_CORDENADOR`) REFERENCES `tb_usuario` (`ID_USUARIO`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE TB_IDIOMA (
  ID_IDIOMA int(8) NOT NULL,
  NOME varchar(120) NOT NULL,
  PAIS varchar(120) NOT NULL,
  PRIMARY KEY (`ID_IDIOMA`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

   
CREATE TABLE TB_AUTOR (
  ID_AUTOR int(11) NOT NULL AUTO_INCREMENT,
  NOME varchar(60) NOT NULL,
  SOBRENOME varchar(60) NOT NULL,
  PRIMARY KEY (ID_AUTOR)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_EDITORA (
  ID_EDITORA int(8) NOT NULL AUTO_INCREMENT,
  NOME varchar(255) NOT NULL,
  PRIMARY KEY (ID_EDITORA)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_LIVRO (
  ID_LIVRO int(11) NOT NULL,
  TITULO varchar(120) NOT NULL,
  SUBTITULO varchar(120) NOT NULL,
  DATA_CADASTRO datetime NOT NULL,
  PRECO decimal(5,2) DEFAULT NULL,
  ID_IDIOMA int(11) NOT NULL,
  CODIGO_ISBN varchar(13) NOT NULL,
  EDICAO int(3) NOT NULL,
  ANO int(4) DEFAULT NULL,
  PAGINAS int(4) DEFAULT NULL,
  VIDEO tinyint(1) NOT NULL,
  CD_DVD tinyint(1) NOT NULL,
  E_BOOK tinyint(1) DEFAULT NULL,
  BROCHURA tinyint(1) DEFAULT NULL,
  DESCRICAO text,
  ID_EDITORA int(11) NOT NULL,
  EXCLUIDO tinyint(1) DEFAULT NULL,
  REVISTA tinyint(1) NOT NULL,
  PRIMARY KEY (`ID_LIVRO`),
  UNIQUE KEY `CODISBN_UNIQUE` (`CODIGO_ISBN`),
  UNIQUE KEY `ID_IDIOMA_UNIQUE` (`ID_IDIOMA`),
  KEY `fk_tb_idioma_idx` (`ID_IDIOMA`),
  CONSTRAINT `fk_tb_idioma` FOREIGN KEY (`ID_IDIOMA`) REFERENCES `tb_idioma` (`ID_IDIOMA`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_LIVRO_AUTOR (
  ID_LIVRO int(11) NOT NULL,
  ID_AUTOR int(11) NOT NULL,
  KEY fk_livro_idx (id_livro),
  KEY fk_autor (id_autor),
  CONSTRAINT fk_autor FOREIGN KEY (id_autor) REFERENCES tb_autor (id_autor) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT fk_livro FOREIGN KEY (id_livro) REFERENCES tb_livro (ID_LIVRO) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE TB_MARCA (
  ID_MARCA int(8) NOT NULL AUTO_INCREMENT,
  NOME varchar(255) NOT NULL,
  PRIMARY KEY (ID_MARCA)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;


/* SCRIPTS DE INSERÇÃO PRA FACILITAR TESTES */
INSERT INTO TB_FUNCAO
(ID_FUNCAO, NOME, DESCRICAO)
VALUES
('1', 'PROF', 'PROF DA PUC');

INSERT INTO TB_USUARIO
(ID_USUARIO,USUARIO,SENHA,ADMINISTRADOR,MATRICULA,NOME,EMAIL,DATA_CADASTRO, ID_FUNCAO, CPF)
VALUES
('10', 'admin', 'admin', '1', '00000', 'Cássio Trindade', 'cassio.trindade@pucrs.br', '2015-10-01 00:00:00', '1', '12345789999');

INSERT INTO TB_IDIOMA
(ID_IDIOMA, PAIS, NOME)
VALUES
(1, 'BRASIL', 'PORTGUÊS');

INSERT INTO TB_AUTOR
(ID_AUTOR,NOME,SOBRENOME)
VALUES
( 1, 'Paulo', 'Coelho');

INSERT INTO TB_EDITORA
(ID_EDITORA,NOME)
VALUES
( 1, 'Abril');

INSERT INTO TB_EDITORA
(ID_EDITORA,NOME)
VALUES
( 2, 'Saraiva');

INSERT INTO TB_LIVRO
(ID_LIVRO,TITULO,SUBTITULO,DATA_CADASTRO,ID_IDIOMA,CODIGO_ISBN,EDICAO, ANO, PAGINAS, VIDEO, CD_DVD, E_BOOK, BROCHURA, DESCRICAO, ID_EDITORA, EXCLUIDO, REVISTA)
VALUES
( 1, 'A arte da guerra', '--', '2015-10-01 00:00:00', 1, 111111111111, 1, 1990, 100, 1, 0, 1, 1, 'NOVO LIVRO', 1, 0, 0);

INSERT INTO TB_LIVRO_AUTOR
(ID_LIVRO,ID_AUTOR)
VALUES
(1, 1);

INSERT INTO TB_LIVRO_AUTOR
(ID_LIVRO,ID_AUTOR)
VALUES
(1, 1);

INSERT INTO TB_MARCA
(ID_MARCA, NOME)
VALUES
(1, 'SAMSUNG');

